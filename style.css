// --- Main elements ---
const grid = document.getElementById("gameGrid");
const search = document.getElementById("search");
let allGames = [];

// --- Settings elements ---
const settingsBtn = document.getElementById("settingsBtn");
const settingsPanel = document.getElementById("settingsPanel");
const closeSettings = document.getElementById("closeSettings");
const showNamesToggle = document.getElementById("showNamesToggle");
const funButton = document.getElementById("funButton");
const themeSelect = document.getElementById("themeSelect");
const modeSelect = document.getElementById("modeSelect");

let currentTheme = "purpleBlack";
let currentMode = "dark";

// --- Theme definitions ---
const themes = {
  purpleBlack: { primary: "#b784ff", secondary: "#e0d7ff", glow: "rgba(183,132,255,0.6)" },
  blueBlack: { primary: "#7fd1ff", secondary: "#cceeff", glow: "rgba(127,209,255,0.6)" },
  redBlack: { primary: "#ff7f7f", secondary: "#ffcccc", glow: "rgba(255,127,127,0.6)" },
  greenBlack: { primary: "#7fff7f", secondary: "#ccffcc", glow: "rgba(127,255,127,0.6)" }
};

// --- Apply theme & mode ---
function updateThemeColors() {
  const theme = themes[currentTheme];

  document.body.style.background = currentMode === "dark" ? "#0b0b0b" : "#f4f4f4";
  document.body.style.color = currentMode === "dark" ? theme.secondary : "#333";
  document.querySelector(".top h1").style.color = currentMode === "dark" ? theme.primary : "#555";
  document.querySelector("#search").style.color = currentMode === "dark" ? theme.secondary : "#333";

  settingsBtn.style.background = currentMode === "dark" ? theme.primary : "#aaa";
  settingsBtn.style.color = currentMode === "dark" ? "#0b0b0b" : "#000";

  // Game cards
  document.querySelectorAll(".game").forEach(card => {
    const nameDiv = card.querySelector(".name");
    if (nameDiv) nameDiv.style.color = currentMode === "dark" ? theme.secondary : "#000";

    const glowColor = currentMode === "dark" ? theme.glow : "rgba(0,0,0,0.2)";
    card.onmouseover = () => card.style.boxShadow = `0 0 25px ${glowColor}`;
    card.onmouseout = () => card.style.boxShadow = "none";
  });

  // Settings panel header and buttons
  document.querySelector("#settingsPanel h2").style.color = currentMode === "dark" ? theme.primary : "#555";
  document.querySelectorAll("#settingsPanel button").forEach(btn => {
    btn.style.background = currentMode === "dark" ? theme.primary : "#ccc";
    btn.style.color = currentMode === "dark" ? "#0b0b0b" : "#000";
  });

  // Bear Easter egg
  const bearMsg = document.querySelector("#gameGrid .bear-message");
  if (bearMsg) bearMsg.style.color = currentMode === "dark" ? theme.primary : "#555";
}

// --- Fetch games ---
fetch("games.json")
  .then(res => res.json())
  .then(data => {
    allGames = data.games;
    render(allGames);
  });

// --- Render games ---
function render(games) {
  grid.innerHTML = "";

  if (games.length === 0) {
    grid.innerHTML = "<p style='text-align:center;color:#888;'>No games found.</p>";
    return;
  }

  games.forEach(game => {
    const div = document.createElement("div");
    div.className = "game";
    div.innerHTML = `
      <img src="${game.image}" alt="${game.name}">
      <div class="name">${game.name}</div>
    `;
    div.onclick = () => window.location.href = `play.html?url=${encodeURIComponent(game.url)}`;
    grid.appendChild(div);
  });

  updateThemeColors(); // Apply theme to new cards
}

// --- Search + bear Easter egg ---
search.addEventListener("input", () => {
  const q = search.value.toLowerCase();

  if (q === "bear") {
    grid.innerHTML = `
      <div class="bear-message" style="display:flex;justify-content:center;align-items:center;flex-direction:column;">
        <img src="assets/bear.png" style="width:300px;height:auto;margin-top:20px;">
        <div style="font-size:24px;margin-top:10px;">üêª You found the bear!</div>
      </div>
    `;
    updateThemeColors();
    return;
  }

  render(allGames.filter(g => g.name.toLowerCase().includes(q)));
});

// --- Settings panel open/close ---
settingsBtn.addEventListener("click", () => settingsPanel.classList.add("show"));
closeSettings.addEventListener("click", () => settingsPanel.classList.remove("show"));

// --- Show/hide game names ---
showNamesToggle.addEventListener("change", () => {
  document.querySelectorAll(".game .name").forEach(nameDiv => {
    nameDiv.style.display = showNamesToggle.checked ? "block" : "none";
  });
});

// --- Fun Easter egg ---
funButton.addEventListener("click", () => {
  alert("üéâ You found a secret in settings!");
});

// --- Theme selector ---
themeSelect.addEventListener("change", () => {
  currentTheme = themeSelect.value;
  updateThemeColors();
});

// --- Mode selector ---
modeSelect.addEventListener("change", () => {
  currentMode = modeSelect.value;
  updateThemeColors();
});

// --- Initial theme ---
updateThemeColors();
